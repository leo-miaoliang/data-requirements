# 四个1V4的班主任8，9月学员课时消耗


**需求来源**

提出人: "霍崇崇"<chongchong.huo@uuabc.com>

部门:

**拉取周期**
2018-11-13


**用途**
7/26-9/15期间，有四个1V4的班主任转到中教团队、以后他们当月以及前面的一个月的课程消耗数字出了问题，请求支持，帮忙拉出这四名中教在班主任期间，名下学员的课程消耗明细。
具体参开3个维度，如下；
【学员ID】【7/26-8/25课程消耗数量】【8/26-9/15课程消耗数量】

附件为4个sheets，分别是杨东亚，林浩，阙寿玲，孙宁他们当时名下学员的ID。

**详细**

```
```

**SQL**

```sql
drop table if exists tmp_teacher_student;

create temporary table tmp_teacher_student
(
    student_id int
    ,teacher_id int
);

insert into tmp_teacher_student
values
(80509,483),
(80237,483),
(75872,483),
(71318,483),
(69740,483),
(68610,483),
(66715,483),
(65769,483),
(65357,483),
(65047,483),
(65044,483),
(64963,483),
(64677,483),
(64487,483),
(64481,483),
(64418,483),
(64292,483),
(63962,483),
(63833,483),
(63780,483),
(63379,483),
(63283,483),
(61618,483),
(61181,483),
(60876,483),
(59813,483),
(59613,483),
(59565,483),
(58984,483),
(58948,483),
(57827,483),
(57791,483),
(57239,483),
(56758,483),
(56729,483),
(56595,483),
(54577,483),
(54377,483),
(53825,483),
(52751,483),
(50986,483),
(49049,483),
(49038,483),
(48878,483),
(37881,483),
(32038,483),
(25296,483),
(25117,483),
(14857,483),
(14301,483),
(328,483),
(48610,483),
(49831,483),
(53286,483),
(87806,483),
(57987,483),
(88253,483),
(85070,483),
(48524,483),
(58478,483),
(96218,483),
(103669,483),
(101936,483),
(100313,483),
(91258,483),
(88253,483),
(64658,483),
(25172,483),
(53941,483),
(59813,483),
(59329,483),
(58762,483),
(57721,483),
(61179,483),
(58183,483),
(59565,483),
(58796,483),
(60638,483),
(54377,483),
(49831,483),
(64481,483),
(57239,483),
(59610,483),
(54377,483),
(48578,483),
(52751,483),
(47284,483),
(58595,483),
(48878,483),
(56969,483),
(56666,483),
(56804,483),
(49831,483),
(58137,483),
(62301,483),
(55060,483),
(54052,483),
(56729,483),
(55105,483),
(56666,483),
(56535,483),
(56595,483),
(56403,483),
(56214,483),
(56209,483),
(55834,483),
(55808,483),
(55621,483),
(55592,483),
(75872,483),
(32038,483),
(63780,483),
(64164,483),
(14301,483),
(80237,483),
(57721,483),
(58137,483),
(55408,483),
(55582,483),
(55060,483),
(55058,483),
(55019,483),
(54104,483),
(58595,483),
(64963,483),
(50007,483),
(49606,483),
(49293,483),
(48578,483),
(47263,483),
(25522,483),
(25221,483),
(25172,483),
(24998,483),
(23100,483),
(74225,483),
(72684,483),
(64804,483),
(64745,483),
(64658,483),
(64577,483),
(64164,483),
(63475,483),
(63437,483),
(63338,483),
(63256,483),
(62933,483),
(62766,483),
(62301,483),
(61640,483),
(61572,483),
(61089,483),
(61081,483),
(60986,483),
(60921,483),
(60574,483),
(60506,483),
(60499,483),
(60468,483),
(60016,483),
(59952,483),
(59815,483),
(59398,483),
(59329,483),
(58796,483),
(58746,483),
(58602,483),
(58583,483),
(58569,483),
(58469,483),
(57914,483),
(57649,483),
(57472,483),
(57468,483),
(57466,483),
(57441,483),
(57348,483),
(57118,483),
(56856,483),
(56818,483),
(56804,483),
(56752,483),
(56666,483),
(56214,483),
(55808,483),
(55722,483),
(55621,483),
(55592,483),
(55421,483),
(55410,483),
(55408,483),
(55267,483),
(55228,483),
(55060,483),
(55033,483),
(54584,483),
(54581,483),
(54418,483),
(54381,483),
(54076,483),
(54052,483),
(54033,483),
(53990,483),
(53936,483),
(53901,483),
(53888,483),
(53583,483),
(53364,483),
(53320,483),
(53262,483),
(53261,483),
(52868,483),
(52571,483),
(52537,483),
(52386,483),
(52373,483),
(52322,483),
(52135,483),
(51729,483),
(51504,483),
(50308,483),
(50091,483),
(49984,483),
(49348,483),
(49151,483),
(49111,483),
(48762,483),
(48725,483),
(48717,483),
(48648,483),
(48618,483),
(48596,483),
(48236,483),
(47422,483),
(47400,483),
(47363,483),
(47304,483),
(47302,483),
(47284,483),
(47279,483),
(47071,483),
(25286,483),
(25209,483),
(25009,483),
(25002,483),
(23100,483),
(23017,483),
(23006,483),
(22991,483),
(22977,483),
(19540,483);


insert into tmp_teacher_student
values
(63699,488),
(74261,488),
(72295,488),
(67876,488),
(73909,488),
(80512,488),
(70940,488),
(67612,488),
(80267,488),
(68393,488),
(80518,488),
(79529,488),
(79697,488),
(59871,488),
(80667,488),
(81733,488),
(48065,488),
(94084,488),
(87389,488),
(87413,488),
(93123,488),
(83496,488),
(87927,488),
(104387,488),
(55492,488),
(91272,488),
(54658,488),
(91223,488),
(87803,488),
(90721,488),
(87845,488),
(89476,488),
(80679,488),
(93604,488),
(63518,488),
(64447,488),
(92135,488),
(104374,488),
(100964,488),
(99723,488),
(98727,488),
(98145,488),
(97254,488),
(94669,488),
(90828,488),
(90341,488),
(88671,488),
(83132,488),
(76380,488),
(70225,488),
(70216,488),
(70067,488),
(67933,488),
(63715,488),
(63063,488),
(62877,488),
(61685,488),
(55050,488),
(54551,488),
(53898,488),
(54439,488),
(53363,488),
(49346,488),
(48782,488),
(47228,488),
(25617,488),
(25063,488),
(25060,488),
(23335,488),
(91268,488),
(82201,488),
(79347,488),
(78808,488),
(77768,488),
(77395,488),
(76591,488),
(75055,488),
(73450,488),
(73377,488),
(73375,488),
(72909,488),
(72454,488),
(72313,488),
(71861,488),
(71402,488),
(70833,488),
(70820,488),
(70688,488),
(70319,488),
(70253,488),
(70178,488),
(70031,488),
(69453,488),
(68790,488),
(68259,488),
(67935,488),
(67916,488),
(67857,488),
(67821,488),
(67172,488),
(66858,488),
(66822,488),
(66215,488),
(66092,488),
(65905,488),
(65375,488),
(65366,488),
(65062,488),
(65052,488),
(64927,488),
(64924,488),
(64883,488),
(64874,488),
(64868,488),
(64834,488),
(64815,488),
(64784,488),
(64771,488),
(64683,488),
(64648,488),
(64611,488),
(64560,488),
(64427,488),
(64425,488),
(64386,488),
(64378,488),
(64272,488),
(64122,488),
(63960,488),
(63406,488),
(63253,488),
(63131,488),
(63116,488),
(62997,488),
(62876,488),
(62861,488),
(62790,488),
(62635,488),
(62621,488),
(62561,488),
(62539,488),
(62527,488),
(61612,488),
(61604,488),
(61543,488),
(61424,488),
(61405,488),
(61388,488),
(61378,488),
(61104,488),
(61088,488),
(61055,488),
(61051,488),
(61011,488),
(60478,488),
(60308,488),
(60125,488),
(59961,488),
(59889,488),
(59884,488),
(59754,488),
(59641,488),
(59629,488),
(59616,488),
(59435,488),
(59428,488),
(59324,488),
(59316,488),
(59304,488),
(59260,488),
(59172,488),
(59147,488),
(91346,488),
(91272,488),
(91271,488),
(78342,488),
(72692,488),
(68989,488),
(67790,488),
(66719,488),
(66223,488),
(65800,488),
(65332,488),
(65274,488),
(65250,488),
(64972,488),
(64870,488),
(64800,488),
(64782,488),
(64690,488),
(64667,488),
(74229,488),
(74187,488),
(73806,488),
(73788,488),
(73355,488),
(72779,488),
(72762,488),
(72708,488),
(72678,488),
(72675,488),
(72648,488),
(70763,488),
(70041,488),
(69307,488),
(67911,488),
(66701,488),
(66649,488),
(66214,488),
(66183,488),
(65893,488),
(65367,488),
(65131,488),
(64939,488),
(64911,488),
(64895,488),
(64836,488),
(64692,488),
(64680,488),
(64587,488),
(64528,488),
(64267,488),
(64179,488),
(63981,488),
(63814,488),
(63742,488),
(63710,488),
(63468,488),
(63460,488),
(63430,488),
(62622,488),
(62379,488),
(61563,488),
(61186,488),
(61099,488),
(60151,488),
(59879,488),
(58714,488),
(57268,488),
(56636,488),
(56435,488),
(56396,488),
(56177,488),
(54544,488),
(54543,488),
(53929,488),
(53784,488),
(53296,488),
(53264,488),
(53236,488),
(53164,488),
(53090,488),
(51417,488),
(49071,488),
(48520,488),
(48443,488),
(47319,488),
(23183,488),
(22973,488),
(79414,488),
(77756,488),
(72305,488),
(72171,488),
(71157,488),
(71103,488),
(71100,488),
(71082,488),
(70812,488),
(70692,488),
(70075,488),
(69767,488),
(69747,488),
(65834,488),
(65055,488),
(64078,488),
(63332,488),
(63316,488),
(62463,488),
(62380,488),
(61430,488),
(61189,488),
(60963,488),
(60933,488),
(58276,488),
(57461,488),
(56953,488),
(56862,488),
(56857,488),
(56467,488),
(56191,488),
(55298,488),
(55206,488),
(55074,488),
(54321,488),
(53878,488),
(48515,488),
(25110,488),
(25101,488);

insert into tmp_teacher_student
values
(95826,469),
(94671,469),
(79793,469),
(76371,469),
(76116,469),
(75287,469),
(74268,469),
(74264,469),
(74227,469),
(74190,469),
(74142,469),
(73936,469),
(73389,469),
(73374,469),
(72685,469),
(72448,469),
(72356,469),
(71407,469),
(71400,469),
(71391,469),
(70828,469),
(70618,469),
(70594,469),
(70213,469),
(70111,469),
(69735,469),
(69056,469),
(68988,469),
(68358,469),
(67927,469),
(67922,469),
(67818,469),
(67009,469),
(66915,469),
(66834,469),
(66799,469),
(66703,469),
(66662,469),
(66661,469),
(66658,469),
(66656,469),
(66630,469),
(66212,469),
(66097,469),
(66095,469),
(65240,469),
(65122,469),
(65053,469),
(64842,469),
(64823,469),
(64818,469),
(64816,469),
(64783,469),
(64612,469),
(64589,469),
(64585,469),
(64579,469),
(64491,469),
(64215,469),
(64212,469),
(64082,469),
(64073,469),
(63809,469),
(63793,469),
(63736,469),
(63734,469),
(63656,469),
(63653,469),
(63586,469),
(63485,469),
(63471,469),
(63433,469),
(63425,469),
(63355,469),
(63343,469),
(63171,469),
(63163,469),
(63149,469),
(63095,469),
(63072,469),
(63047,469),
(63034,469),
(63031,469),
(62973,469),
(62931,469),
(62929,469),
(62927,469),
(62906,469),
(62899,469),
(62884,469),
(62797,469),
(62768,469),
(62754,469),
(62743,469),
(62632,469),
(62620,469),
(62618,469),
(61917,469),
(61647,469),
(61602,469),
(61560,469),
(61413,469),
(61406,469),
(61382,469),
(61198,469),
(61025,469),
(60873,469),
(60230,469),
(60177,469),
(59965,469),
(59810,469),
(59711,469),
(59263,469),
(58818,469),
(58783,469),
(58747,469),
(58646,469),
(58538,469),
(58357,469),
(57966,469),
(57950,469),
(57926,469),
(57828,469),
(57490,469),
(57438,469),
(57424,469),
(57310,469),
(57302,469),
(57267,469),
(57027,469),
(56903,469),
(56859,469),
(56808,469),
(56801,469),
(56776,469),
(56770,469),
(56696,469),
(56641,469),
(56619,469),
(56605,469),
(56421,469),
(56401,469),
(56203,469),
(56132,469),
(56096,469),
(55601,469),
(55424,469),
(55268,469),
(55075,469),
(54491,469),
(54360,469),
(54128,469),
(54123,469),
(54117,469),
(54007,469),
(53961,469),
(53927,469),
(53923,469),
(53910,469),
(53842,469),
(53756,469),
(53586,469),
(53410,469),
(53367,469),
(53231,469),
(53074,469),
(52633,469),
(52564,469),
(52513,469),
(51755,469),
(51640,469),
(51626,469),
(51624,469),
(51623,469),
(49870,469),
(49327,469),
(48809,469),
(48800,469),
(48773,469),
(48712,469),
(48697,469),
(48685,469),
(48657,469),
(48646,469),
(48643,469),
(48559,469),
(48352,469),
(48088,469),
(48017,469),
(47995,469),
(47964,469),
(47648,469),
(47647,469),
(47631,469),
(47547,469),
(47483,469),
(47229,469),
(25496,469),
(25173,469),
(25102,469),
(24999,469),
(24987,469),
(24381,469),
(23750,469),
(22953,469),
(48541,469),
(74112,469),
(72252,469),
(70742,469),
(70321,469),
(70243,469),
(68408,469),
(67888,469),
(65858,469),
(65224,469),
(65080,469),
(64789,469),
(64752,469),
(64275,469),
(62878,469),
(62335,469),
(61542,469),
(61075,469),
(61062,469),
(59687,469),
(58481,469),
(58168,469),
(58142,469),
(58119,469),
(57434,469),
(57299,469),
(56622,469),
(55878,469),
(53600,469),
(53374,469),
(53253,469),
(53119,469),
(52546,469),
(51646,469),
(49902,469),
(49357,469),
(48680,469),
(47174,469),
(25577,469),
(25214,469),
(21642,469),
(18822,469),
(16829,469),
(801,469),
(25022,469),
(100457,469),
(97670,469),
(97577,469),
(95900,469),
(95785,469),
(95372,469),
(95278,469),
(95036,469),
(95034,469),
(94642,469),
(94268,469),
(93954,469),
(91648,469),
(88829,469),
(87928,469),
(86615,469),
(86449,469),
(85651,469),
(85053,469),
(81932,469),
(79524,469),
(79141,469),
(78982,469),
(77383,469),
(76585,469),
(76104,469),
(74335,469),
(73944,469),
(73770,469),
(73428,469),
(73352,469),
(73274,469),
(73061,469),
(72672,469),
(72503,469),
(72422,469),
(72327,469),
(103494,469),
(79493,469);

insert into tmp_teacher_student
values
(75858,492),
(53212,492),
(58640,492),
(82202,492),
(80540,492),
(69490,492),
(53104,492),
(78050,492),
(79526,492),
(87857,492),
(76241,492),
(65576,492),
(88673,492),
(88291,492),
(84434,492),
(85818,492),
(90746,492),
(92973,492),
(92974,492),
(53971,492),
(95312,492),
(57014,492),
(78445,492),
(69060,492),
(68644,492),
(65202,492),
(64659,492),
(57165,492),
(64069,492),
(87499,492),
(97580,492),
(97227,492),
(97241,492),
(84647,492),
(84647,492),
(79253,492),
(81716,492),
(96296,492),
(73040,492),
(98946,492),
(84450,492),
(52100,492),
(64034,492),
(47595,492),
(56517,492),
(55596,492),
(55508,492),
(25100,492),
(25111,492),
(57638,492),
(59828,492),
(23101,492),
(59249,492),
(25294,492),
(70081,492),
(63821,492),
(64210,492),
(65902,492),
(66327,492),
(64399,492),
(62378,492),
(65841,492),
(60988,492),
(51238,492),
(60572,492),
(55495,492),
(52361,492),
(59595,492),
(68080,492),
(65251,492),
(16746,492),
(88291,492),
(55372,492),
(77852,492),
(70010,492),
(51122,492),
(52527,492),
(72432,492),
(72468,492),
(64274,492),
(78727,492),
(47313,492),
(59457,492),
(68544,492),
(55811,492),
(48565,492),
(57717,492),
(59724,492),
(53846,492),
(58623,492),
(58551,492),
(58148,492),
(57968,492),
(57633,492),
(56200,492),
(55014,492),
(54431,492),
(54366,492),
(53275,492),
(53256,492),
(52748,492),
(52577,492),
(52527,492),
( 48579,492),
(48565,492),
(47534,492),
(25464,492),
( 25008,492),
(23024,492),
(59406,492),
(58480,492),
(23038,492),
(54486,492),
(53997,492),
(55047,492),
(61524,492),
(58635,492),
(91730,492),
(73797,492),
(64743,492),
(62893,492),
(62558,492),
(61625,492),
(61539,492),
(61385,492),
(61374,492),
(61173,492),
(61031,492),
(59880,492),
(59844,492),
(58790,492),
(58501,492),
(58500,492),
(58480,492),
(58473,492),
(58148,492),
(58064,492),
(57462,492),
(57445,492),
(57418,492),
(56843,492),
(56762,492),
(56627,492),
(56463,492),
(55198,492),
(55134,492),
(55070,492),
(55014,492),
(54569,492),
(54022,492),
(53967,492),
(53812,492),
(53169,492),
(49364,492),
(47591,492),
(47246,492),
(25503,492),
(25150,492),
(25095,492),
(25084,492),
(23408,492),
(64743,492),
(47067,492),
(63469,492),
(66221,492),
(74223,492),
(78201,492),
(70141,492),
(58587,492),
(72173,492),
(55713,492),
(57447,492),
(69737,492),
(72293,492),
(65249,492),
(76129,492),
(54284,492),
(76968,492),
(78227,492),
(78464,492),
(67797,492),
(70137,492),
(73430,492),
(73946,492),
(75964,492),
(74001,492),
(64508,492),
(62936,492),
(77761,492),
(49692,492),
(53810,492),
(64826,492),
(50844,492),
(64600,492),
(64650,492),
(69238,492),
(64518,492),
(66698,492),
(58204,492),
(47368,492),
(52523,492),
(63240,492),
(55273,492),
(53097,492),
(57607,492),
(61447,492),
(57260,492),
(62317,492),
(63909,492),
(58533,492),
(51735,492),
(57182,492),
(57530,492),
(53170,492),
(25539,492),
(59196,492),
(53780,492),
(58070,492),
(55732,492),
(59290,492),
(55635,492),
(61054,492),
(58648,492),
(66824,492),
(63404,492),
(47171,492),
(78727,492),
(22983,492),
(67836,492),
(55839,492),
(79329,492),
(70081,492),
(60869,492),
(61622,492),
(75205,492),
(64811,492),
(61236,492),
(57326,492),
(74901,492),
(64943,492),
(64894,492),
(64846,492),
(64828,492),
(64624,492),
(64172,492),
(62890,492),
(62623,492),
(61501,492),
(61422,492),
(61416,492),
(61372,492),
(61180,492),
(61115,492),
(60874,492),
(59664,492),
(59645,492),
(59408,492),
(59375,492),
(59266,492),
(59189,492),
(58826,492),
(58698,492),
(58560,492),
(58545,492),
(58529,492),
(58366,492),
(58146,492),
(57965,492),
(57958,492),
(57921,492),
(57857,492),
(57382,492),
(57100,492),
(56914,492),
(56855,492),
(56575,492),
(56571,492),
(56563,492),
(56559,492),
(56552,492),
(55332,492),
(55224,492),
(54607,492),
(54574,492),
(54563,492),
(54547,492),
(54391,492),
(54361,492),
(54338,492),
(54305,492),
(53972,492),
(53359,492),
(53293,492),
(53266,492),
(53031,492),
(52768,492),
(52495,492),
(51727,492),
(51455,492),
(50083,492),
(48807,492),
(48617,492),
(48557,492),
(47962,492),
(47720,492),
(47183,492),
(47182,492),
(47070,492),
(25564,492),
(25241,492),
(25233,492),
(25122,492);



select
    t1.teacher_id
    ,t2.tag1
    ,t3.truename
    ,sum(case when t2.date1 < 20180826 and t2.class_type = 1 then 1 else 0 end) as cnt1_month8  -- 语言课
    ,sum(case when t2.date1 < 20180826 and t2.class_type = 5 then 1 else 0 end) as cnt2_month8  -- 素质课
    ,sum(case when t2.date1 >= 20180826 and t2.class_type = 1 then 1 else 0 end) as cnt1_month9  -- 语言课
    ,sum(case when t2.date1 >= 20180826 and t2.class_type = 5 then 1 else 0 end) as cnt2_month9  -- 素质课
from tmp_teacher_student t1
inner join
    (select
        student_user_id as student_id
        ,'old' as tag1
        ,1 as class_type
        ,date(convert_tz(from_unixtime(start_time), '+00:00', '+08:00')) as date1
    from newuuabc.appoint_course
    where course_type = 3  -- 正式课
    and disabled = 0  -- 正常
    and status = 3  -- 已上课
    and class_appoint_course_id <> 0
    and date(convert_tz(from_unixtime(start_time), '+00:00', '+08:00')) between 20180726 and 20180915
    union all
    select
        student_id
        ,'new' as tag1
        ,class_type
        ,date(from_unixtime(start_time)) as date1
    from classbooking.student_class
    where status = 3
    and date(from_unixtime(start_time)) between 20180726 and 20180915
    )   t2
on  t1.student_id = t2.student_id
left join
    newuuabc.admin t3
on  t1.teacher_id = t3.masterid
group by t1.teacher_id, t3.truename
;

```

**备注**

